\documentclass{report}

\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{dsfont}
\usepackage{bm}
\usepackage[a4paper, total={6in,8in}]{geometry}
\usepackage{graphicx}
\usepackage{float}
\usepackage{subcaption}
\usepackage{datetime}
\usepackage{natbib}
\usepackage{hyperref}

%\usepackage{amssymb}
%\usepackage{amsfonts}
%\usepackage{amsmath}
%\usepackage{dsfont}
%\usepackage{bm}
%\usepackage[a4paper, total={6in,8in}]{geometry}
%\usepackage{graphicx}
%\usepackage{float}
%\usepackage{subcaption}
%\usepackage{natbib}
%\usepackage{hyperref}

\graphicspath{{/figures/}{Matlab Demos/sounds/}{voiced_sounds/case_1}{voiced_sounds/case_2}{voiced_sounds/case_3}}

\title{Models for Phonation}
\author{Will Woolfenden}

\begin{document}

\begin{titlepage}
    \begin{center}
        \vspace*{1cm}
            
        \Huge
        \textbf{Models for Phonation}
            
        \vspace{0.5cm}
        \LARGE
        Mathematical Models for Voice Production in Nonlinear Dynamics
            
        \vspace{1.5cm}
            
        \textbf{Will Woolfenden}
        
        \vspace{0.5cm}
        
        $10628968$
            
        \vfill

        Project supervisor: Prof. Oliver Jensen \\

        \vspace{0.8cm}
            %final submission
        Submission for MATH30000 Double Project for the $2022/23$ academic year
            
        \vspace{0.8cm}
            
        \Large

        School of Mathematics\\
        The University of Manchester\\
        United Kingdom\\
        \today
    \end{center}
\end{titlepage}

\begin{abstract}
    A single mass model for phonation considers steady Bernoulli flow through a channel and a vocal fold modelled by a stiff mass.
    The model formulates a second order non-linear ordinary differential equation for the motion of the mass with two parameters.
    Conditions for oscillations can be expressed in terms of the parameters involved,
    and we deduce explicit results involving the stationary equilibrium solutions.
    We formulate the equation as a first order vector ODE and derive the Jacobian matrix for equilibria,
    allowing us to compute eigenvalues which inform us on the stability of these stationary points.
    A two mass model considers the same problem with two stiffness-coupled masses and a quasisteady flow.
    We obtain a fourth order system with four parameters.
    Under strong stiffness coupling, the two masses move as one and are able to replicate the oscillatory behaviour of the single mass model.
    We explore parameter configurations that yield different equilibrium solutions,
    and again construct the Jacobian matrix to analyse the stability of these equilibrium solutions.
    In some cases, we can obtain results analytically.
    We introduce methods to verify solutions through analytical and numerical methods,
    and provide a Fourier analysis of particular results which yield frequency spectra of quasiperiodic motions.
    We end by analysing the results of the two mass model in relation to real phonation and considering how the models could be improved.
\end{abstract}

\chapter{Introduction}
\label{cha:intro}

\section{The concept and process of phonation}

Phonation is a complex human mechanical process in which the vocal cords, being small regions of flexible tissue located in the larynx,
begin to vibrate as air is expelled from the lungs and lower airway passages towards the throat and out of the mouth.
As such, phonation can be regarded as the interation of two processes in the body,
being the exhalation of air from the lungs,
and the forcing of muscles in the larynx.
The extremely rich and varied tones that may be produced form the basis for the production of elongated vowel sounds.

The phonation process begins when air is expelled from the lungs.
The diaphragm contracts, applying a pressure to the lungs which causes air to be driven out.
Air travels through the airways, which have an extremely complicated, inverted tree-like structure,
collecting in the bronchi (single airway per lung) and then trachea (single airway).
Now in the upper airways, the air travels upwards from the trachea, through the larynx, and out of the body through either the nose or mouth.
It is in the larynx that the mechanical process of phonation occurs.
The glottis is the opening in the larynx between the vocal folds,
hence the glottis must be open in order for phonation to occur.
When air travels through the glottis,
a decrease in pressure may cause the vocal folds to oscillate.
When these oscillations occur,
the propagation of the vibrations lead to the production of voiced sounds.

When the glottis closes, it may be that the vocal folds come to rest,
or it could be that the glottis collapses quickly, for example in a pattern of coughing or choking.
In this case, it is important to consider how the vocal folds might collapse but then rebound open again,
and how this would occur.
The vocal folds do not deform in a linearly elastic manner \cite{alipour_2012},
meaning that the rate at which they strain is not directly proportional to the stress they are subjected to.
We could imagine that on a sudden closure of the glottis,
a forcing pressure from the lower airway drives the vocal folds apart again.
Deformations of the vocal folds on collision are one of the features considered in ``Synthesis of voiced sounds from a two-mass model of the vocal cords'' \cite{ishizaka_flanagan_1972},
which will be discussed more in the section on reviewing mathematical models.

The tones produced by the oscillations of the vocal folds produce a harmonic series,
which is the nature of all pitched sounds, such as those produced by musical instruments.
A harmonic series, in this context,
means that the waveform produced by the oscillations is a series on integer-frequency-valued periodic functions,
relative to a \textit{fundamental frequency}.
Conventionally, the mathematical definition of the harmonic series is the infinite sum:
\begin{equation*}
    \hat{W} = \sum_{n=1}^{\infty}\frac{1}{n} = 1 + \frac{1}{2} + \frac{1}{3} + \mathellipsis.
\end{equation*}
The overtone series is the application of the harmonic series to the frequency of oscillations.
If we have a fundamental frequency $\omega$, then we can take a series of periodic functions, in this case sine,
on integer multiples of the fundamental frequency.
We can write this in series form as follows:
\begin{equation*}
    W(x,t) = \sum_{n=1}^{\infty}a_n \sin(ct) \sin(n \omega x).
\end{equation*}
For clarity, $W$ is a function on length $x$ and time $t$.
The wave speed $c$ is the speed at which the waves oscillate in time,
and $\omega$ is their fundamental frequency.
All frequencies $n\omega$ are integer multiples of $\omega$.
We may consider $x$ to be bounded on an interval, such as $[0, \pi]$.
In this case, we can visualise $W$ as a series of waves on a string.
The constant coefficients $a_n$ define the weighting of the linear combination of the periodic functions.
A different bias on different regions of the harmonic series lead to different textures of sound.

When formulating mathematical models,
we will make several assumptions that reduce the complexity of the model,
which make the process of constructing purely mathematical expressions much easier than they would be otherwise.
However, these approximations and assumptions also reduce the complexity of the mathematics we derive,
meaning we lose features that would arise from a model that accommodates more complex features of phonation.
There are two reasons we make these assumptions.
First of all, due to the scope of this project,
certain features must be neglected in order to finalise mathematical relationships that we can analyse in detail.
Furthermore, we want to prioritise certain aspects that we would expect to see from the model,
which in this case is the oscillatory motion of the vocal cords,
and hence it is reasonable to neglect features that are not directly important for this process.
For example, we could neglect terms in equations if their primary importance was describing how the tension on a vocal cord affects the texture of the tone it produces,
since we are not interested in terms which give extremely precise modifications to the oscillations.

\section{Motivation}

Models for phonation provide insight on the mechanics that contribute to real voice production.
Humans do not have conscious control over the vocal folds,
rather the muscles in the larynx work together with the exhalatory pressure from the lungs in order to induce glottal oscillations.
As such, producing a model for phonation means we can begin to understand the mechanics of the process.

Our goal is to formulate a model for phonation,
which we wish to can analyse to obtain mathematical descriptions of real voice production.
This can be divided into several sections.
First, we will briefly discuss the principles of mathematical modelling in fluid mechanics,
so we have a strong foundation before building our models.
When we are constructing a mathematical model,
we will be able to understand how different assumptions in the basic fluid mechanics lead to different components of the model.
Finally, this carries through into the analysis of the model,
allowing us to make links between the results a model provides,
and the mechanical properties that cause these behaviours.
If we produce a model starting with only fundamental mechanics,
then we can more easily understand which components of the model merit which features that arise in our analysis.
This means we have clear links between the physics that forms our model,
and the properties of our results.

Once we have a model,
there are many directions that can be explored to develop our study,
A mechanical model can act as a foundation for synthesis of speech \cite{ishizaka_flanagan_1972},
where we would apply mathematical principles of sound wave propagation.
Phonation is affected by plenty of factors outside of the glottal region itself,
most notably the resonance coming from the structure of the lower and upper airways as well as the mouth.
The models we explore are simplified,
and more generally study the properties of Bernoulli flow in wind tunnels.
These have applications to the study of fluid mechanics and aerodynamics of channel flows.

\section{Modelling phonation}

As discussed, we will make limitations to the mathematical models we consider,
to refine the model into something we can feasibly analyse while also gaining interesting results.
First of all, while inspiratory phonation (inspiration) differs from expiratory phonation (exhalation),
we will only focus on the expiratory flow case.
In the construction of the model, the cases turn out to be identical up to symmetry anyway.
We will also simplify the geometry of a model of the larynx,
reducing the problem to the flow through a cuboid, with a vocal fold modelled by a movable wall on the side of the channel.
The motion of the wall can be restricted by Hooke springs, and we can control their properties.

We will also assume either a steady or quasisteady flow.
While it is entirely possible for the flow in real speech to be turbulent and not steady,
assuming otherwise allows us to apply Bernoulli's equation for a steady flow,
which gives a simple yet powerful statement on the relationship between pressure $p$, density $\rho$ and flow velocity $\mathbf{u}$.
Restricting our investigation to incompressible fluids, namely where $\rho$ is constant,
provides similar simplifications to our analysis.

Due to the symmetry of the vocal tract,
we can simplify our analysis by only studying one side,
since accommodating both sides in our model would only provide insight under asymmetric forcing terms or initial conditions.

Further assumptions we consider are the one-dimensional motion of the modelled vocal folds,
the elasticity being linear and modelled by Hooke springs,
and a simple geometry for the vocal tract. 

\section{Literature review for mathematical models of phonation}

The paper ``Synthesis of voiced sounds from a two-mass model of the vocal cords'' \cite[1972]{ishizaka_flanagan_1972} is arguably the most important work of research in the field of mathematical models for phonation.
In their research, Ishizaka and Flanagan devise a two-mass model for the vocal cords, and then compute results to generate synthesised voiced sounds.
The model consists of two masses to represent a vocal fold, which are stiffness coupled, comprising the wall of a channel.
A flow passes through the channel and sound waves propagate from the planes,
and the approximation to voiced sounds is computed as the result of the waves transmitted. %% bit more on wave physics maybe

The two mass model is an extremely simple yet insightful model,
which generates behaviours of seemingly erratic oscillations.
The main body of this project is the formulation and analysis of a two mass model.

In the mathematical study of phonation, the myoelastic and aerodynamic theories suggest the nature of the production of voiced sounds.
The myoelastic theory assumes that the vocal cords repeatedly close,
each time being driven apart by the pressure from the forced airflow from the lower airways,
and the frequency of this repeated process determines the frequency of the voiced sounds.
The aerodynamic theory instead applies the properties of pressure in a fluid flow,
imposing that a pressure drop in the glottis leads to sustained oscillations of the vocal cords.
This kind of pressure drop is often referred to as \textit{Bernoulli pressure}, which will be discussed in more depth later.
It is commonly believed that both theories are involved in the production of voiced sounds,
and the ideas are discussed by Titze in ``Comments on the myoelastic-aerodynamic theory of phonation'' \cite[1980]{titze_1980}.
Titze is an extremely prominent author in the field of voice and hearing in mathematical modelling.

The research paper ``Theory and measurement of snores'' \cite[1993]{gavriely_jensen_1993} involves a model which is not designed to approximate phonation.
Rather, its purpose is to provide mechanical insights to the factors present in obstructive sleep apnea.
However, the model itself can be applied to the investigation of phonation,
being a single mass in the wall of a channel subject to stiffness and Bernoulli pressure.
One of the authors, Oliver Jensen, is the supervisor for this project.

Mathematical models for the vocal folds are often heavily simplified, and hence some features of natural phonation are lost.
In ``Synthesis of breathy, normal, and pressed phonation using a two-mass model with a triangular glottis'' \cite[2011]{birkholz_2011},
the authors construct a model for phonation which considers a glottis of a particular shape, which is able to close gradually.
The model is able to synthesise more modes of voiced sounds than traditional models,
particularly being able to produce the range of sounds from ``breathy'' speech (soft-spoken, close to whispering) to ``pressed'' (tense, thin). 

\section{Principles of fluid mechanics}

Euleriean fluid mechanics in a Cartesian coordinate system defines a flow $\mathbf{u}=(u_x,u_y,u_z)$ in a $2$D or $3$D domain,
which is a function of position $\mathbf{r} = (x,y,z)$ and time $t$.
We will describe the $3$D case.
As well as a flow $\mathbf{u}$,
we have fluid density $\rho$ and pressure $p$,
which are often functions of position and time.
In the cases we will study,
we assume the flow is imcompressible,
meaning $\rho$ is uniform across the domain of the flow.
This may appear like a restrictive assumption,
but we still obtain rich and interesting mathematical results from the analysis of an incompressible flow.

The Eulerian framework fundamentally describes the flow field, not the fluid it contains.
The change in a property $\bullet$ of a fluid object must be found using the material derivative
\begin{equation}
    \frac{D\bullet}{Dt} = \frac{\partial \bullet}{\partial t} + (\mathbf{u}\cdot \nabla)\bullet
\end{equation}
where $\nabla$ is the vector differential operator.

A steady flow is a flow $u$ which is independent of time.
The streamlines in a steady flow are fixed, and are identical to the paths taken by a supposed particle placed into a flow at any time.
Bernoulli's equation for a steady flow is as follows:
\begin{equation}
    \frac{1}{2}|\mathbf{u}|^2 + \Omega + \int\frac{\mathrm{d}p}{\rho} = \mathrm{constant~along~a~streamline}.
\end{equation}
The term $\Omega$ is the potential for the body forces on the fluid, such as gravity.
If the potential is either zero or constant,
then $\Omega$ cancels when applying Bernoulli's equation since the body forces $\mathbf{F} = \nabla \Omega$ are zero. %plurals
For our research, we will assume there are no body forces and thus neglect $\Omega$.
Bernoulli's equation is extremely useful, since it gives us a relationship between fluid velocity and pressure in a steady flow.

Fluid mass flux $Q$ at a given cross-section is the rate at which fluid mass passes through the region,
given in terms of an integral:
\begin{equation*}
    Q = -\iint_A \rho \mathbf{u} \cdot \mathbf{n} \mathrm{d}S,
\end{equation*}
where $\mathbf{n}$ is the outer unit normal to a cross-section.
By convention, the outer unit normal points away from the volume,
hence in the opposite direction of the flow, thus we require the negative sign.
This leads to the principle of conservation of mass, where the net flux entering a volume $V$ is the same as the rate of change of fluid mass within that volume.
The net flux is the flux out minus the flow in.
This can be formally expressed as follows
\begin{equation*}
    \iiint_V \frac{\partial\rho}{\partial t} \mathrm{d}V = - \iint_A \rho \mathbf{u} \cdot \mathbf{n} \mathrm{d}S 
\end{equation*}
We can combine conservation of mass with the fact that for an incompressible fluid,
the material derivative of density $D\rho / Dt$ is zero.
We obtain an expression for incompressibility
\begin{equation*}
	\nabla \cdot \mathbf{u} = 0.
\end{equation*}

In this research project, the models we will consider involve simplified geometry and more straightforward assumptions of mechanics in comparison to some of the literature we have acknowledged.
Fundamentally, we want to consider a fluid flow through a rigid channel, and suppose that a region of wall has freedom of motion in one dimension normal to the flow.
It is appropriate to introduce the definition of a \textit{plug flow}, being a fluid flow through a channel in which the flow is uniform over cross-sections through the channel.
The plug flow model is a general form for the simple geometry channel flow models we will consider throughout this project.
We will only discuss a case for a two-dimensional flow, since the intricacies are not vital to our analysis.
Assume an incompressible steady flow \(\mathbf{u}(x)\) travels through a channel in the positive $x$ direction and has zero velocity in the $y$ direction.
such that the horizontal $x$ length $L$ of the flow is much larger than vertical $y$ width $W$.
We assume the flow is uniform over a cross section.
We can evaluate flux over a cross-section with length/area $A$
since velocity is uniform over said cross section, and we obtain
\begin{equation}
	Q(x) = -\int_W \rho \mathbf{u}\cdot \mathbf{n} dS = WU
\end{equation}
where $U = \mathbf{u}(x) \cdot \mathbf{e}_x $ at the point in the path of the flow normal to the cross section.
The elementary vector $\mathbf{e}_x$ is the unit vector in the positive $x$ direction.
Velocity still may change in $x$, for example if the flow is driven by a pressure gradient in the $x$ direction.
This gives us a very flexible method to express the fluid flux in a rigid channel.

\section{Principles of non-linear dynamics and dynamical systems}

The modelling of phonation uses techniques from analysing systems of differential equations.
The study of dynamical systems, as far as we are concerned,
involves studying systems of differential equations that describe time-dependence in a model,
and provides insight into characteristics of a model such as equilibrium solutions and classes of behaviours.
In Chapter \ref{cha:onemass}, we study a single mass model to approximate a vocal cord,
and in Chapter \ref{cha:twomass} we generalise into a two mass model and obtain a fourth order system of differential equations.
In all cases the equations of motion are autonomous and non-linear.
Consider the example on two variables \((x,~y)\), being
\begin{equation}
    \begin{aligned}
        \frac{\mathrm{d}x}{\mathrm{d}t} &= f(x,y) \\
        \frac{\mathrm{d}y}{\mathrm{d}t} &= g(x,y).
    \end{aligned}
\end{equation}
In this example,
the equations are autonomous,
which will be the case for all problems considered in this report.
The \textit{phase portrait} is the representation in which the coordinate axes are the variables $x,y$,
which can be generalised to higher dimensional cases,
but cannot be fully visualised for dimensions higher than three.
We use phase-portrait representation as an alternative visualisation of the behaviour of a system.
If a variable $x$ is governed by an ODE,
we plot its behaviour over time where the different axes represent velocity $dx/dt$ against position $x$,
rather than just visualising position against time.
The phase-portrait is a useful method of representation for problems in dynamical systems,
since an ODE or system of ODEs can be characterised by the locations and properties of its stationary equilibria.
This alternative approach allows us to construct visualisations that show some characteristics of a system more clearly, such as the radii of different closed orbits,
and the positions of equilibrium solutions.
The path we visualise in the phase portrait is a curve of the behaviour of the system parameterised by time $t$. 
Representation of solutions in the phase portrait will be vital to our analysis of our models.

If the equations \(f\) and \(g\) are non-linear,
we can't do much to solve this equation.
Aside from producing numerical computations, we could look intuitively for equilibrium solutions \((x,y) = (x_0,y_0)\),
which are fixed point solutions for which all time derivatives of \(x\) and \(y\) are zero.
Hence equilibrium solutions are equivalently solutions to the homogeneous couple \(f(x,y) = 0,~g(x,y) = 0\).
Close to an equilibrium solution,
we would expect the functions' behaviour to be well approximated by their first order Taylor Series approximations, being
\begin{equation}
    \begin{aligned}
        f(x,y) &\approx f(x_0,y_0) + (x-x_0)\frac{\partial f}{\partial x}(x_0,y_0) + (y-y_0)\frac{\partial f}{\partial y}(x_0,y_0) \\
        g(x,y) &\approx g(x_0,y_0) + (x-x_0)\frac{\partial g}{\partial x}(x_0,y_0) + (y-y_0)\frac{\partial g}{\partial y}(x_0,y_0).
    \end{aligned}
\end{equation}
The constant terms disappear since \(f, g\) are zero at an equilibrium by definition.
As $(x,y) \rightarrow (x_0,y_0)$, the terms of order $n > 1$ approach zero,
and the most significant terms are those involving the first partial derivatives.
We obtain the approximation for the system local to an equilibrium solution,
\begin{equation}
    \begin{aligned}
        \frac{\mathrm{d}x}{\mathrm{d}t} &= \left(\frac{\partial f}{\partial x}(x_0,y_0)\right)(x-x_0) + \left(\frac{\partial f}{\partial y}(x_0,y_0)\right)(y-y_0) \\
        \frac{\mathrm{d}y}{\mathrm{d}t} &= \left(\frac{\partial g}{\partial x}(x_0,y_0)\right)(x-x_0) + \left(\frac{\partial g}{\partial y}(x_0,y_0)\right)(y-y_0),
    \end{aligned}
\end{equation}
which is a system of linear equations.
For convenience, we make the substitutions \(u = x-x_0,~v = y-y_0\) which are linear substitutions proportional to the variables of interest \((x,y)\).
Hence the above approximation is equivalent to the following matrix equation:
\begin{equation}
    \frac{\mathrm{d}}{\mathrm{d}t} \begin{pmatrix}
        u \\
        v
    \end{pmatrix} = \begin{bmatrix}
        \frac{\partial f}{\partial x}(x_0,y_0) & \frac{\partial f}{\partial y}(x_0,y_0) \\
        \frac{\partial g}{\partial x}(x_0,y_0) & \frac{\partial g}{\partial y}(x_0,y_0)
    \end{bmatrix} \begin{pmatrix}
        u \\
        v
    \end{pmatrix}.
\end{equation}
Letting \(\mathbf{u} = (u,v)^\mathrm{T}\) and writing \(J\) as the matrix of derivatives,
we can write the matrix equation compactly as \( \dot{\mathbf{u}} = \mathbf{Ju}\), where the dot denotes the time derivative.
The matrix \(\mathbf{J}\) is the \textit{Jacobian matrix}.
The Hartman-Grobman Theorem in dynamical systems tells us a very important result,
being that the behaviour of the system near the stationary point can be determined by computing the Jacobian matrix \(\mathbf{J}\) at the equilibrium solution,
and computing the eigenvalues of the matrix.
The Jacobian is often a sparse matrix, and its eigenvalues are often complex.
For every equilibrium solution, we must compute the Jacobian and its eigenvalues in order to determine the behaviour of the system at all equilibrium points.
For clarity, the eigenvalues of the Jacobian are the constant terms \(\lambda\) that solve the equation \( \mathbf{J} -  \lambda \mathbf{I} = \mathbf{0}\),
where \(\mathbf{I}\) is the appropriate size identity matrix.
This also concerns the problem of finding equilibrium solutions in the first place, which is usually non-trivial.
Importantly, the vector $\mathbf{u}$ is defined on the independent variables $u,v$ which map one-to-one to the vectors which define the phase portrait.
Hence, eigenvectors of the matrix $\mathbf{J}$ are vectors in the phase portrait from equilibrium solutions,
hence they affect behaviours of the system near these stationary points.

The most important result on eigenvalues of equilibria is that an equilibrium solution is unstable if any of its eigenvalues have positive real part.
Recall that the linearisation of the system is of the form
\begin{equation}
	\dot{\mathbf{u}} = \mathbf{Ju}.
\end{equation}
If $\mathbf{J}$ has an eigenvalue $\lambda$ for an eigenvector $\mathbf{u}_0$,
then we can model the trajectory from this eigenvector by the ODE and initial condition
\begin{equation*}
	\begin{aligned}
		\dot{\mathbf{u}} &= \lambda \mathbf{u}, \\
		\mathbf{u}(t=0) &= \mathbf{u}_0.
	\end{aligned}
\end{equation*}
This is a first order vector ODE and has a general solution
\begin{equation}
	\mathbf{u} = \mathbf{u}_0 e^{\lambda t}
\end{equation}
and hence the value of $\lambda$ determines the trajectory from the initial point $\mathbf{u}_0$.
If $\lambda$ has a positive real part then the trajectory diverges exponentially from the equilibrium and hence the equilibrium is unstable.

For a more rigorous understanding of the linearisation of a system of equations and an understanding of the Hartman-Grobman Theorem,
see \cite{perko_textbook_1996},
particularly sections 1.1 on simple examples of linear systems,
1.5 on two-dimensional linear systems,
1.9 on the theory of stability,
and 2.6 on linearisation.

\section{Housekeeping}

We will briefly discuss the notation used and any preliminary notes on methods.
Within a chapter, all notation will be almost completely consistent,
however variables are not consistent across separate chapters.
For example, we use $\mu$ as a parameter for the single mass model,
and denote eigenvalues of the Jacobian with $\lambda$,
however in the two mass model we use $\lambda$ as a parameter and thus it cannot be used to also denote eigenvalues,
so we denote eigenvalues with $\sigma$ instead.

The only significant inconsistency in our writing is when we derive the two mass model.
We denote the dimensional dependent variables $h_1,h_2,$
and analyse the model to obtain the dimensionless variables $\hat{h}_1,\hat{h}_2.$
Once we have obtained the ODEs in nondimensional form,
we won't consider the dimensional variables again,
so for simplicity we change back to writing the independent variables as $h_1,h_2$,
but use them to denote the nondimensional quantities.
We do the same for all the nondimensionalised variables in the problem.

The computations in this project are all performed in MATLAB,
using the $64$-bit double precision floating point arithmetic standard.

\section{Structure}

The first section of this project studies the single mass model from ``Theory and measurement of snores'' \cite{gavriely_jensen_1993},
which is a model formulated to consider the factors involved in obstructive sleep apnea.
We will find that the features derived in the model are very relevant to the investigation of phonation,
and that this single mass model serves as a strong basis for more generalised models.

In the second section, we generalise the single mass model into a structure in which two masses model a single vocal cord,
where the masses have a component of stiffness coupling between them.
This model builds on the single mass model,
but also takes strong inspiration from the two mass model formulated in ``Synthesis of voiced sounds from a two-mass model of the vocal cords'' \cite{ishizaka_flanagan_1972},
which discusses the formulation of a mathematical model for the purpose of generating artificial speech using a computer.
The formulation and study of the two mass model is the largest and most important part of work contained in this project.
After having investigated the single mass model and the two mass model,
we will review the approximations and simplifications made during the formulation processes and suggest refinements to the models.
We conclude by discussing the results, which are the insights to the nature of phonation that we have gained from inspecting the behaviours of the models.

\include{project_phonation_doc.tex}

\include{twomass.tex}

\chapter{Critique of the models, overview of results and conclusion}
\label{cha:conclusion}

\section{Improving our models}

\subsection{Energy}

Both the single mass and the two mass model are systems which perfectly preserve energy.
This is not consistent in the computations,
but we have shown for both models that there exists a constant term,
depending on the variables of position and velocity,
which is unchanging in time.
From a realistic perspective,
systems tend to dissipate energy and eventually come to rest,
rather than behaving like perfect conservative machines that operate indefinitely.

Both models we have studied lack any form of damping,
so all potential energies are perfectly transferred to kinetic energies and vice versa.
If we were to introduce a damping parameter,
we would observe closed oscillations about a stationary point to always converge to that equilibrium,
rather than oscillating indefinitely.

A mass $m$ attached to a Hooke spring obeys the ODE
\begin{equation*}
	m\frac{\mathrm{d}^2 x}{\mathrm{d}t^2} + k(x-x_0) = 0
\end{equation*}
where $x$ is the length of the spring, $x_0$ is the length at rest,
$k$ is the stiffness,
and $t$ is time.
This is the equation for a simple harmonic oscillator,
with equilibrium solution $x=x_0$.
The general solution is the expression
\begin{equation*}
	x = x_0 + A\exp \left(
		\sqrt{-\frac{k}{m}}t
	\right) + B\exp \left(
		-\sqrt{-\frac{k}{m}}t
	\right),
\end{equation*}
where $A$ and $B$ are free constants.
With the inclusion of a damping parameter,
we obtain a different ODE
\begin{equation*}
	m\frac{\mathrm{d}^2 x}{\mathrm{d}t^2} + c\frac{\mathrm{d}x}{\mathrm{d}t} + k(x-x_0) = 0
\end{equation*}
where the constant $c$ describes the damping strength.
We retain the equilibrium solution $x=x_0$, but the general solution changes to
\begin{equation*}
	x = x_0 + A \exp \left(
		\frac{-c+\sqrt{c^2-4mk}}{2m}t
	\right) + B \exp \left(
		\frac{-c-\sqrt{c^2-4mk}}{2m}t
	\right).
\end{equation*}
We require $m,~k,~c$ to be positive constants.
The harmonic oscillator is periodic,
whereas the damped harmonic oscillator eventually decays to rest at the equilibrium.

Our models describe systems where energy is perfectly transferred between useful forms,
namely potential and kinetic energies.
In other words, the systems we study have $100\%$ efficiency.
In reality, there are virtually no dynamical systems with this level of efficiency,
rather that some energy is always wasted.
If would be interesting to develop our models by introducing forms of energy dissipation,
such that our models would not describe systems which are $100\%$ efficient.
We could then consider how the forcing pressure could adapt to continue phonation to take place when the motion of the vocal cords begins to decay towards equilibrium.

% talk about voice and natural systems that lose energy

\subsection{Elasticity}

From studies into the material properties of the vocal cords,
they have been observed to deform under stress with nonlinear elasticity \cite{alipour_2012}.
However, in the models we have studied,
the stiffness of the vocal cords are modelled with linear elasticity by a Hooke spring.
It is important to note that in the two mass model,
we simplified these assumptions further,
by approximating the stiffness coupling by a linear force,
rather than as the vertical component of a diagonal spring.

The purpose of our mathematical models are to describe the potentially intricate motion of the vocal cords.
In order to do this,
we used Hooke springs to model the stiffnesses.
While not ideal, these are fundamental to the quasiperiodic behaviours we observed in the two mass model.
If we considered non-linear stiffnesses,
these might provide fundamentally different oscillations to our observations.
However, our analysis does not extend to the impacts of different spring behaviours on the results.
Rather, we made the approximation of linear Hooke springs and analysed their impact in depth.

It also serves to mention that the linear Hooke spring is a first-order approximation to the stiffness of a real spring.
As such, it is reasonably accurate for small displacements,
which occur in the proximity of stable equilibria,
being a large portion of our analysis.

\subsection{Stablility of fluid flow}

In both models,
we applied Bernoulli's equation for a steady flow in order to deduce a relationship between the velocity and the pressure of the fluid.
It is possible for the spoken sounds in phonation to be produced by a steady flow,
but phonation can occur more generally for unsteady, turbulent flows,
and this is not a case which is accommodated in our modelling.

In the two mass model,
we forced the assumption of a quasisteady flow,
however this reduced the cases we accommodated in the modelling.
Ideally we would construct a model which provides accurate simulation of vocal folds moving, subject to a turbulent flow through the glottis.
However, the quasisteady flow still provided rich results which led to a wide variety of behaviours which we were able to analyse.
Were we to develop the model and introduce the non-steady flow,
it would be very important to replicate results from the quasisteady flow assumption.
This is because if a model cannot retain a result when a component changes,
then there may be something fundamental to that original component,
which we have now lost.
As such,
it was important to focus on the quasisteady flow assumption,
even if this does not capture the range of flow types that may be involved in phonation.

When we began to discuss the two mass model,
we introduced relationships between the fluxes and the velocities of the masses.
We supported these suggestions with the argument of conservation of mass for an incompressible fluid.
However, the quasisteady flow was a stronger assumption which neglected these rules.
If we were to develop the model,
these assumptions on the flux would be good candidates to involve in the modelling.
The quasisteady flow implies ``$\mathrm{change~in~volume}=\mathrm{change~in~flux}$'' for any fixed volume.

\subsection{Physical structure of the model}

The formulation of the two mass model involved extremely simple geometry,
being the flow through a rectangular channel.
A more varied and irregular structure,
similar to the interior shape of the larnyx and glottis,
could potentially influence the dynamics of the fluid flow.
A varying inner channel width could have implications in Bernoulli flow,
and could contribute to more complex flow patterns in phonation.

The masses which model the vocal cord are extremely simple objects,
being stiffness-coupled planes,
and are restricted to one dimensional motion in the direction of their ourward normal.
In reality, the vocal folds have a much more intricate shape than the cuboid blocks we modelled them as.
We could develop the two mass model by constructing the vocal fold with a much more gemoetrically complex shape,
and allowing more degrees of freedom in their motion.
This would lead to more complex behaviour in the motion of the masses,
but it would be difficult to recover results from the simpler model which we have analysed.
This is because the ODE we have analysed in the two mass model is characteristic of the one dimensional motion.
If we were to remove this restriction,
we would obtain a system of PDEs describing motion in more than one degree of freedom,
and it would be difficult to replicate the one dimensional results from our two mass model.

\section{Discussion}

\subsection{Aims}
% what did we aim to do

In this project,
we aimed to explore mathematical models for phonation,
and analyse the characteristics that they can produce.
We began by exploring a single mass model from a research paper,
and derived results on its behaviour.
We explored equilibrium solutions and criteria for closure.

We generalised the properties of the single mass problem into a model involving two separate, stiffness-coupled masses.
We analysed distinct behaviours of the two mass model,
again investigating equilibrium solutions.
We investigated the complex shape of the motion of the masses,
and performed computational Fourier analysis on different results to provide insight into the frequencies of the oscillations.

\subsection{The single mass model}
% what does the single model do

The single mass model exhibits oscillations when parameters take suitable values.
Orbits oscillate about a stable equilibrium $b_2$ in the phase portrait.
In the proximity of the unstable equilibrium $b_1$,
orbits will gravitate towards the unstable point.
Trajectories near $b_1$ outside the bound for oscillations will diverge from this unstable point and eventually reach closure.

\subsection{The two mass model}
% what does the two mass model do

We constructed the two mass model by generalising the single mass model,
but we chose to cover the formulation of the model from scratch.
Two masses are given a coupling stiffness,
and we aim to produce more complex dynamics with the two mass model.

The two mass model always retains at least one equilibrium solution.
Strong stiffness coupling between the masses can replicate the structure of solutions for the single mass model.
In most cases,
we can observe four separate equilibrium solutions for the system.
Results such as the equilibrium solutions themselves, and the eigenvalues of the Jacobian local to these points,
must be computed numerically.
Some equilibrium solutions are often unstable and so precise that a computation at these equilibria eventually diverges into large oscillations.
The motion of the masses is often quasiperiodic,
following one or several dominant frequencies of oscillation.

We could verify results by deriving an energy constant for the system from definite integration.
This energy constant was used to verify the reliability of results.

Finally, we performed Fourier analysis on a selection of results in order to analyse the frequency space of the quasiperiodic motion.
We were able to analyse the spectra of the oscillations,
where some results showed clear discrete peaks in the frequency space,
but others showed more continuous ranges of oscillation frequencies.

\subsection{Equilibrium solutions}
% what is an equilibrium in phonation

The existence of equilibrium solutions suggests that, during phonation, the vocal folds can remain in fixed positions under particular forcing terms.
The nature of stable and unstable equilibria imply different relationships between forces local to these points.
An unstable equilibrium suggests that a vocal cord may remain in a fixed shape under a precise balance of forces,
and will diverge from this position when offset even slightly.
However, a stable equilibrium implies that if energy were to slowly dissipate from the system then a vocal cord will come to rest at a fixed position.

The two mass model yields different kinds of equilibrium solutions.
We defined two categories, being diagonal and off-diagonal equilibria.
The diagonal equilibria are stationary points where both components of a vocal cord are close together.
When a diagonal equilibrium is unstable,
the components of the vocal cord start close together but are sensitive to initial conditions,
and if their positions are offset slightly then they will diverge into their own quasiperiodic motions like we observed.
If the point is instead stable then a slight offset leads to continuous small oscillations.
The off-diagonal equilibria are points where the components of a vocal cord have a significant distance apart from each other, so the stiffness coupling induces tension which is balanced by the Bernoulli flow and individual stiffnesses.
We have no results where the off-diagonal equilibria are stable,
instead we have observed that the component positions diverge when slightly offset.
In fact, these are so sensitive to position that the machine arithmetic used in our computations is not precise enough to store variables that maintain equilibrium.
The eigenvalues of these equilibria are entirely imaginary in all cases we have considered.

\subsection{Quasiperiodic motion}
% what is quasiperiodic motion in phonation

We analysed the Fourier spectrum of the motion of the two mass model,
showing that the motions are formed from a harmonic series of frequencies.
Different Fourier spectra indicate different combinations of the harmonic series,
which produce different textures of sound.
This analysis applies most naturally to pitched sounds, such as the tones produced by musical instruments.
If, for example, we recorded a violin and a clarinet both playing exactly the same note and performed Fourier transforms on the data,
we would observe vastly different frequency spectra with the same fundamental frequency.
Singing is an example of phonation producing pitched sounds,
however natural speech also has pitch and timbre formed form a harmonic series.
Hence, we can apply the Fourier transform to analyse the frequency spectrum.
From our results, we deduced that the two mass model is capable of producing a range of sound textures from the range of unique frequency spectra we observed.

\subsection{Collapse}
% what is collapse in phonation

The collapse of the glottis in regular phonation leads to the airway becoming blocked and building up pressure.
In our analysis, however, closure is considered to be a stopping condition and hence we do not explore behaviours after collapse.
The single mass model accommodated for the possibility of no equilibrium solutions,
and in these cases we would always observe closure in sufficient time.
For the two mass model, there is instead always at least one equilibrium solution,
so we do not have the same closure conditions.
However in both of our models,
collapse tends to occur when either one or both masses is sufficiently close to $0$,
where the Bernoulli pressure term in the model dominates and the masses accelerate to closure.

These results could infer that in real phonation,
a sufficiently small glottal opening could cause collapse,
and so the oscillations can only be sustained if they remain bounded to a particular interval.
If the range of oscillations is too large and exceeds these bounds,
the glottal opening could become too small would cause a dominating pressure term,
where it would be likely for closure to occur.

\section{Conclusion}
% what do we know about phonation from our models

From our models,
we can deduce that the principle factors in phonation are the stiffness of the vocal cords and how they behave under the pressure from a steady Bernoulli flow from the lungs.
A two mass model characterises phonation as the motion of two stiffness-coupled components of a single vocal fold.
Under sufficient parameters, the two mass model reproduces the regular periodic orbits that we see in the single mass model.
However, the two mass model is much more sensitive and shows more interesting behaviours,
since it is a fourth order system describing two masses with a stiffness coupling.
In general, we observe quasiperiodic motion of the components of the vocal folds,
and the model accommodates that oscillations could continue indefinitely due to the lack of any energy sink in the model.
This quasiperiodic motion is a weighted sum of a harmonic series of frequencies,
which can be visualised using a Fourier transform.
The two mass model is capable of producing signals with discrete peaks in the frequency spectrum,
but also with frequencies clustered together more continuously.
In the results we have observed,
both components of the two mass model appear to resonate with each other,
since the frequency domains are often identical but the power representations in the Fourier transforms are weighted slightly differently.

We have discussed approaches which could improve the model.
To extend the study of models for phonation, we could apply a more complex circulation of energy within the system.
We could also consider more kinds of fluid flow,
for example by exploring how phonation may occur for turbulent, unstable flows.
In turn, it could be beneficial to develop the geometry of our models,
and consider multiple degrees of freedom in the motion of the modelled vocal folds.
Were we to develop these aspects of our model,
it would be interesting to see how our results develop,
however it is also important that we are still able to reproduce fundamental results.

The two mass model we have studied is capable of producing quasiperiodic motions of two stiffness-coupled components of a vocal cord.
In formulating the model,
we have made assumptions that may limit the potential for valuable, intricate results that provide strong insight into the nature of phonation.
However, the results we have obtained provide forms of motion which we can analyse and relate to real phonation.
Particularly, we showed that the results from the two mass model can be analysed as a harmonic series of frequencies,
which is a key characteristic of the acoustic structure of voiced sounds.

\bibliographystyle{unsrt}
\bibliography{sources.bib}

\appendix

%% bibliography styles
% agsm is harvard
% unsrt is standard numerical
% ieeetr is whatever jasmine uses

\chapter{Computations}

\section{Unstable results}

\begin{figure}[h!]
	\centering
	\includegraphics[width=\linewidth]{figures/twomass_timeseries_settling_2.eps}
	\caption{
		Long term behaviour of the model under parameters \(\alpha=1,~\lambda=0.5,~\beta=3,~\omega=0.3\).
		Computed with \texttt{ode45()} using default tolerances.
		Oscillations tend towards an equilibrium solution given computation on a large timescale.
		Initial conditions \((1,3.79)\).
		The equilibrium solution is computed to be $(4.31,5.88)$.
		The behaviours diverge from the initial behaviours and slowly settle to equilibria,
		despite the lack of any damping in the system.
		This is an unreliable solution, due to an inadequately high tolerance in the computation.
	}
	\label{fig:twomass_timeseries_settling}
\end{figure}

\begin{figure}[h!]
	\centering
	\includegraphics[width=\linewidth]{figures/twomass_individual_converging}
	\caption{
		Parameters given are \((1, 0.8, 3, 1)\). The masses oscillate near independently starting at different positions $(1.96, 0.83)$ at time $t=0$.
		The figures, left to right, progressively increase the time we run the computation.
		We can see in the left-most plot that the weak coupling leads to the masses oscillating at independent frequencies.
		As running time increases, the masses converge to their own equilibrium positions.
	}
	\label{fig:twomass_independent}
\end{figure}

\begin{figure}[h!]
	\centering
	\includegraphics[width=\linewidth]{figures/twomass_error_convergence.eps}
	\caption{
		Changes in solution as \(\mathtt{AbsTol}\) is decreased.
		Computations under parameters \((1, 0.8, 3, 1)\) with initial positions \((1.96, 0.83)\).
		The computed solution fundamentally changes under stepping down the tolerance.   
	}
	\label{fig:twomass_stepping_tolerance}
\end{figure}

\begin{figure}[h!]
	\centering
	\includegraphics[width=\linewidth]{figures/twomass_energy_comparison.eps}
	\caption{
		Solution from \texttt{ode45()} for the problem seen in Figures \ref{fig:twomass_nested_interesting_1} and \ref{fig:twomass_energy_madplot}.
		Without reducing the tolerance of the solver,
		the solution diverges.
	}
	\label{fig:twomass_energy_mistake}
\end{figure}

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.9\linewidth]{figures/twomass_poincare_map.eps}
	\caption{
		Another example of the Poincar\'e map, for the computation shown earlier in Figure \ref{fig:twomass_timeseries_settling}.
		We have shown that this result is not reliable, since we can compute that the energy constant diverges.
		As we can see, the orbits break out of a pattern and the points on the Poincar\'e map begin to converge.
	}
	\label{fig:twomass_poincare_bad}
\end{figure}

We cannot expect a numerical method to produce results which would perfectly match analytical behaviours.
However, it is sensible to deduce that there are families of behaviours that the model may exhibit,
which the numerical methods are incapable of reproducing.
For example, the computation shows that the initial quasiperiodic behaviour of Figure \ref{fig:twomass_nested_interesting_1},
which eventually settles to the stable equilibrium as shown in Figure \ref{fig:twomass_timeseries_settling},
can be shown to be invalid through computing the energy constant shown in Figure \ref{fig:twomass_energy_madplot}.
Since the computation of the energy constant for this problem progressively decreases,
we could guess that the quasiperiodic motions will instead continue indefinitely as shown in the early region of the time series.

The numerical solver struggles with the unstable equilibrium solutions,
since near these points, the ODE is extremely sensitive to minute differences in the numerical values.
Due to finite precision floating point arithmetic,
it is extremely difficult to produce consistent results near the unstable equilibria numerically.
In combination with the stiffness coupling, there are often heavily unbalanced forces on each mass,
for example if an unstable equilibrium lies between the two masses.
Figures \ref{fig:twomass_energy_mistake} and \ref{fig:twomass_poincare_bad} show analysis of computations where the behaviour has diverged from a consistent result.
The time series slowly breaks out of quasiperiodic orbits and begins to converge towards a stable equilibrium,
while the reliable solution in Figure \ref{fig:twomass_energy_madplot} shows continuous quasiperiodic behaviour.

Figure \ref{fig:twomass_stepping_tolerance} shows a change in results when reducing the $\mathtt{AbsTol}$ parameter for the MATLAB \texttt{ode45()} function.
The figures show that decreasing the error tolerance can fundamentally change the numerical solution,
especially where closure is not observed for tolerance of order $10^{-5}$,
but is observed for $10^{-10}$.
Recall that $\mathtt{AbsTol}$ is a lower bound on the magnitude of the solution that MATLAB will compute.
Clearly, the closure of the model, being the case of a mass approaching zero,
is affected by how MATLAB handles solutions that approach zero.

\chapter{MATLAB Scripts}

\section{Single mass model}

This code produces computations of the single mass model.
It also includes plotting functions for the curves which represent trajectories in the phase portrait.

\begin{verbatim}
%% ODE Solver using ode45

tspan=[0,20];

%initial conditions. this field should be edited for new results
xinit=[0.2, 0];

q=0.1; k=0.1;
mu = 1;
[t, x] = ode45(@(t,x) OscODE(t,x,mu,q), tspan, xinit)
b=x(:,1);
bdot=x(:,2);

%plot the computation
hold on
plot(t,b)
hold off

%compute equilibrium solutions and store
b_1 = fzero(@(b) OscODE2(t,b,mu,q),0.4)
b_2 = fzero(@(b) OscODE2(t,b,mu,q),0.6)

%% KE Curves Plotter

hold on

fplot(@(x) sqrt(F(x,mu,q) - F(b_1,mu,q)), [0 2])
fplot(@(x) sqrt(F(x,mu,q) - F(b_2,mu,q)), [0 2])
fplot(@(x) sqrt(F(x,mu,q) + F(b_1,mu,q)), [0 2])
fplot(@(x) sqrt(F(x,mu,q) + F(b_2,mu,q)), [0 2])

fplot(@(x) sqrt(F(x,mu,q) - (F(b_2,mu,q) - F(b_1,mu,q))), [0 2])
fplot(@(x) sqrt(F(x,mu,q) - (F(b_2,mu,q) + F(b_1,mu,q))), [0 2])

fplot(0,[0 2],'k-')
hold off


%% Functions

function dbdt = OscODE(t, x, mu, q)

b=x(1);
bdot=x(2);

dbdt=zeros(size(x));
dbdt(1) = bdot;
dbdt(2) = 1 - q - b - (mu*power(q,2))/(2*power(b,2));

end

function d2b = OscODE2(t, b, mu, q)
% used for computing equilibria

d2b = 1 - q - b - (mu.*power(q,2))/(2*power(b,2));

end

function out = F(b,mu,q)
out = (1-q)*b - (b^2)/2 + (mu*q^2)/(2*b);
end
\end{verbatim}

\section{Two mass model}

This is the code used to compute results for the two mass model.
Should be run separately by section.
For a quick result, run the first section,
then ``stationary points and general equilibria solvers",
then the implementation of \texttt{ode45}.
Also includes code for computing eigenvalues near an equilibrium,
plotting graphics of the equilibrium solutions,
and extra functions for verification and computation.

\begin{verbatim}
%% Two Mass Model - Normalised ODE Attempt 3

% final nondimensionalisation

%set the required constants

% alpha is quotient of second mass by first mass, we specify only its
% inverse alpha_inv = m1/m2 since we only ever divide by alpha.
% lambda is the quotient of their support spring stiffnesses k2/k1.
% beta is proportional to the forcing pressure at lung.
% omega is the quotient of the coupling stiffness by spring 1, i.e. if we
% know omega and lambda, you can find the stiffness k_2.

alpha_inv = 1;
lambda = 0.8;
beta = 3;
omega = 0.3;

%% Stationary points and general equilibria solvers

%one-dimensional solvers for individual stationary points, neglecting the
%stiffness coupling
stat_point_11 = fzero(@(x) 1 - x + beta*(1 - power(x, -2)),[1e-5 power(2*beta, 1/3)]);
stat_point_12 = fzero(@(x) 1 - x + beta*(1 - power(x, -2)),[power(2*beta, 1/3), 10]);
stat_point_21 = fzero(@(x) lambda*(1 - x) + beta*(1 - power(x, -2)),[1e-5 power(2*beta/lambda, 1/3)]); 
stat_point_22 = fzero(@(x) lambda*(1 - x) + beta*(1 - power(x, -2)),[power(2*beta, 1/3), 10]);

%solver problem to find equilibria. MUST take vertical vector input
init_search_point = [stat_point_12; stat_point_22];
[steady_soln,fval] = fsolve(@(v) zeroesFunction2(v,lambda,beta,omega),init_search_point);

x_equilibrium = steady_soln(1);
y_equilibrium = steady_soln(2);

%% Eigenvalue computation

df1dx = partDf1(x_equilibrium,beta,omega);
df1dy = omega;
df2dx = omega;
df2dy = partDf2(y_equilibrium,lambda,beta,omega);

jcbn = [
0, 1, 0, 0;
df1dx, 0, df1dy, 0;
0, 0, 0, 1;
alpha_inv*df2dx, 0, alpha_inv*df2dy, 0;
];

eig_vals = eig(jcbn)

% plot the eigenvalues in the complex plane with real, imag axes
hold on
for val = eig_vals
plot([-5 5],[0 0],'k-')
plot([0 0],[-5 5],'k-')
plot(real(val),imag(val),'rx','MarkerSize',8)
end
hold off

%% Contour graphic of equilibrium solutions

x_axis = [-5:0.05:15];
y_axis = [-5:0.05:15]';
z_axis_1 = 1 - x_axis + beta*(1-1./(x_axis.^2)) + omega*(y_axis-x_axis);
z_axis_2 = lambda*(1 - y_axis) + beta*(1-1./(y_axis.^2)) + omega*(x_axis-y_axis);

hold on
contour(x_axis,y_axis,z_axis_1,[-0.001,0,0.001],'b-')
contour(x_axis,y_axis,z_axis_2,[-0.001,0,0.001],'r-')
plot([-5 15],[-5 15],'g-')
hold off

%% Solver - Implementation of ODE45

%enter initial conditions
opts = odeset('AbsTol',1e-20,'RelTol',1e-12);
tspan = [0 100];
init = [stat_point_12, 0, stat_point_22, 0];
[t,x] = ode45(@(t,x) twoMassModel(t,x,alpha_inv, lambda, beta, omega),tspan,init,opts);

E = totalEnergy(x(:,1),x(:,2),x(:,3),x(:,4),alpha_inv,lambda,beta,omega);

% plot different representations
hold on
%plot(x(:,1), x(:,2),'b');
%plot(x(:,3), x(:,4),'r');

plot(t, x(:,1))
plot(t, x(:,3))

%plot(t,E)

%plot(x(:,1),x(:,3))
%hold off

%% Les functiones

%the ODE function on two masses taking parameters alpha, lambda, beta,
%omega
function dhdt = twoMassModel(t,x,alpha_inv,lambda,beta,omega)

%take inputs, initialise the h variables
dhdt = zeros(size(x));

h_1 = x(1);
dh_1 = x(2);
h_2 = x(3);
dh_2 = x(4);

%compute the equation

dhdt(1) = dh_1;
dhdt(2) = 1 - h_1 + beta*(1-1/(h_1)^2) + omega*(h_2-h_1);
dhdt(3) = dh_2;
dhdt(4) = alpha_inv*(lambda*(1 - h_2) + beta*(1-1/(h_2)^2) + omega*(h_1-h_2));

end

function out_vector = zeroesFunction2(v,lambda,beta,omega)
x = v(1);
y = v(2);
out_x = 1-x + beta*(1-(1./(x.^2))) + omega.*(y-x);
out_y = lambda*(1-y) + beta*(1-(1./(y.^2))) + omega.*(x-y);
out_vector = [out_x; out_y];
end

%partial derivatives of f1 and f2
function out = partDf1(x,beta,omega)
out = -1 + 2*beta*power(x,-3) - omega;
end
function out = partDf2(x,lambda,beta,omega)
out = -lambda + 2*beta*power(x,-3) - omega;
end


% conserved energy term
function vec = totalEnergy(x1,v1,x2,v2,alpha_inv,lambda,beta,omega)
kinetic_energy_term = (v1.^2 + (alpha_inv^-1)*(v2.^2))/2;
x_potential_term = (1+beta)*x1 - (x1.^2)/2 + beta./x1;
y_potential_term = (lambda+beta)*x2 - lambda*(x2.^2)/2 + beta./x2;
mixed_term = -omega*((x1-x2).^2)/2;
vec = kinetic_energy_term - x_potential_term - y_potential_term - mixed_term;
end


function starting_pts = findStatPoints(lambda,beta)
stat_point_11 = fzero(@(x) 1 - x + beta*(1 - power(x, -2)),[1e-5 power(2*beta, 1/3)]);
stat_point_12 = fzero(@(x) 1 - x + beta*(1 - power(x, -2)),[power(2*beta, 1/3), 10]);
stat_point_21 = fzero(@(x) lambda*(1 - x) + beta*(1 - power(x, -2)),[1e-5 power(2*beta/lambda, 1/3)]); 
stat_point_22 = fzero(@(x) lambda*(1 - x) + beta*(1 - power(x, -2)),[power(2*beta, 1/3), 10]);
starting_pts = [
stat_point_11, stat_point_12;
stat_point_21, stat_point_22
];
end

function [equilibria_x,equilibria_y] = findEquilibria(sp11,sp12,sp21,sp22,lambda,beta,omega)
%opts_2 = optimset()
steady_soln_11 = fsolve(@(v) zeroesFunction2(v,lambda,beta,omega),[sp11,sp21]);
steady_soln_12 = fsolve(@(v) zeroesFunction2(v,lambda,beta,omega),[sp11,sp22]);
steady_soln_21 = fsolve(@(v) zeroesFunction2(v,lambda,beta,omega),[sp12,sp21]);
steady_soln_22 = fsolve(@(v) zeroesFunction2(v,lambda,beta,omega),[sp12,sp22]);
if any([steady_soln_11 steady_soln_12 steady_soln_21 steady_soln_22]<0)
equilibria_x = [
missing missing;
missing missing
];
equilibria_y = [
missing missing;
missing missing
];
end
equilibria_x = [
steady_soln_11(1), steady_soln_12(1);
steady_soln_21(1), steady_soln_22(1)
];
equilibria_y = [
steady_soln_11(2), steady_soln_12(2);
steady_soln_21(2), steady_soln_22(2)
];
end
\end{verbatim}

\section{Fourier transform and sound file generation}

This code requires that a computation of the two mass model has been performed and is currently stored.

\begin{verbatim}
%% Sound System

%Generates a playable wave form and a Fourier spectrum from data provided
%by the vocal fold model.

%use nufft() for fourier transform

%fourier analysis
D1 = x(:,1);
D2 = x(:,3);
N = length(t);
L = t(N);
F = (0:N-1)/L;

%fourier transform
M1 = nufft(D1, t);
M2 = nufft(D2, t);

%conversion to the power of the frequencies
P1 = abs(M1.^2)/N;
P2 = abs(M2.^2)/N;

%% Generate Sound Files

%reinterpolate the signal to a uniform step
t_new = linspace(0,L,N);
V1 = interp1(t,D1,t_new);
V2 = interp1(t,D2,t_new);

%normalise the signal to [-1, 1]
signal_u = max(max(V1),max(V2));
signal_l = min(min(V1),min(V2));

translation = -(signal_u+signal_l)/2
scaling = 2/(signal_u-signal_l)

V1 = scaling*(V1+translation);
V2 = scaling*(V2+translation);

%suggested playback frequency. 1000 time units is one second
playback_frequency = floor(1000*N/L)

filename="result_name";
info = "parameters alpha=%d, lambda=%d, beta = %d, omega = %d. IV [%d %d]";
comment = sprintf(info,1/alpha_inv,lambda,beta,omega,init(1),init(3));
audiowrite(filename+"a.wav",V1,playback_frequency,'Comment',comment);
audiowrite(filename+"b.wav",V2,playback_frequency,'Comment',comment);
figure1 = plot(F,P1); ylim([0 2e5]); saveas(figure1,filename+"a",'epsc');
figure2 = plot(F,P2); ylim([0 2e5]); saveas(figure2,filename+"b",'epsc');
\end{verbatim}

\end{document}